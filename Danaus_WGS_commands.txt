#commands for ***

#check queue
qstat -f -u "*"

#1. Genotyping



########
#1. GENOTYPING
########

#make list of scaffolds
cut -f1 /data/martin/genomics/analyses/Danaus_genome/Dchry2/Dchry2.2.fa.fai > /data/martin/genomics/analyses/Danaus_mapping/scaf.list

#prepare list of bams
#need to add full filepath
cp Wild100list_90inds_bam.list Wild100list_90inds_full_filepath_bam.list

sed -i 's/^/\/data\/martin\/genomics\/analyses\/Danaus_mapping\//g' Wild100list_90inds_full_filepath_bam.list

sconda genomics_general

touch genotype_run.txt

cat /data/martin/genomics/analyses/Danaus_mapping/scaf.list | while read line
do
echo "bcftools mpileup -O u -d 250 --skip-indels -f /data/martin/genomics/analyses/Danaus_genome/Dchry2/Dchry2.2.fa --annotate FORMAT/DP --bam-list /data/martin/genomics/analyses/Danaus_mapping/Wild100list_90inds_full_filepath_bam.list -r "${line}" | bcftools call -m -f GQ -O u | bcftools filter -e 'FORMAT/DP < 5 | FORMAT/GQ < 20' --set-GTs . -O u | bcftools filter -e 'AN < 2' | bgzip > /scratch/rdekayne/genotyping/"${line}".vcf.gz" >> genotype_run.txt
done

#parallel -j 1 'qsub -cwd -N bcftools -V -pe smp64 1 -l h=bigbang -b yes {}' :::: genotype_run.txt

head -n2 genotype_run.txt > test.geno.txt

parallel -j 1 'qsub -cwd -N bcftools -V -pe smp64 1 -l h=bigbang -b yes {}' :::: test.geno.txt


